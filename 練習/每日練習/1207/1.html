<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>

        body{
            margin: 0;
            background: burlywood;
        }
        .content{
            width: 700px;
            margin: auto;
            background-color: blanchedalmond;
            padding: 10px 40px 50px;
            box-sizing: border-box;
            line-height: 2.3;
            font-size: 24px;
            letter-spacing: 0.7px;
        }
        h3{
            text-align: center;
        }
        .content img{
            width: 300px;
            opacity: 0;
            transition: all .3s ease-in;
            margin: 30px 0;
        }
        .content img:nth-of-type(even){
            float: left;
            height: 600px;
            transform: translateX(-30%);
        }
        .content img:nth-of-type(odd){
            float: right;
            transform: translateX(30%);
        }

        .scroll_animation{
            transform: translateX(0%) !important;
            opacity: 1 !important;
        }

        .clear{
            clear: both;
        }
    </style>
</head>
<body>
    

    <div class="content">

        <h3>嘗試往下移動觸發動畫吧?</h3>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto dicta, sequi quaerat tempore beatae illo. Dolorum odio, mollitia excepturi possimus consectetur suscipit doloremque reprehenderit impedit non iusto blanditiis enim. Reiciendis repudiandae architecto placeat rerum molestiae illum odio qui voluptas nobis, blanditiis tempore, nostrum, fugiat tenetur provident dicta facere minima? Laudantium ullam officia, quibusdam soluta dolore perferendis labore atque itaque hic, incidunt tempora ipsa vitae, ab fuga placeat laborum excepturi unde quam ipsam iure. Voluptas accusamus non minus rem consequatur placeat similique sunt excepturi nulla quaerat sapiente commodi molestias asperiores modi voluptate nesciunt, sint repellat alias quibusdam consequuntur reiciendis? Quia, voluptatem voluptate, temporibus voluptatibus eligendi pariatur a atque eius saepe sint debitis. Ullam dolor tempore obcaecati similique voluptas soluta? Dolore quaerat natus rerum blanditiis odio nam laborum. Praesentium iusto aperiam maiores repellendus velit accusamus eum quisquam officia doloremque vitae culpa deleniti beatae porro, molestias eaque qui vero iure, sequi, doloribus architecto eos ipsum cupiditate. Temporibus deserunt quisquam dignissimos. Quod fugiat velit totam sint id deleniti nemo, inventore in hic debitis officia tenetur? Asperiores incidunt error sequi laborum a vitae numquam cumque at consectetur alias dolores earum perferendis aspernatur voluptatum quam animi hic, quisquam iste deleniti accusamus labore et? Quasi, explicabo architecto.</p>
        <img src="./images/file_369750.png" alt="">
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto dicta, sequi quaerat tempore beatae illo. Dolorum odio, mollitia excepturi possimus consectetur suscipit doloremque reprehenderit impedit non iusto blanditiis enim. Reiciendis repudiandae architecto placeat rerum molestiae illum odio qui voluptas nobis, blanditiis tempore, nostrum, fugiat tenetur provident dicta facere minima? Laudantium ullam officia, quibusdam soluta dolore perferendis labore atque itaque hic, incidunt tempora ipsa vitae, ab fuga placeat laborum excepturi unde quam ipsam iure. Voluptas accusamus non minus rem consequatur placeat similique sunt excepturi nulla quaerat sapiente commodi molestias asperiores modi voluptate nesciunt, sint repellat alias quibusdam consequuntur reiciendis? Quia, voluptatem voluptate, temporibus voluptatibus eligendi pariatur a atque eius saepe sint debitis. Ullam dolor tempore obcaecati similique voluptas soluta? Dolore quaerat natus rerum blanditiis odio nam laborum. Praesentium iusto aperiam maiores repellendus velit accusamus eum quisquam officia doloremque vitae culpa deleniti beatae porro, molestias eaque qui vero iure, sequi, doloribus architecto eos ipsum cupiditate. Temporibus deserunt quisquam dignissimos. Quod fugiat velit totam sint id deleniti nemo, inventore in hic debitis officia tenetur? Asperiores incidunt error sequi laborum a vitae numquam cumque at consectetur alias dolores earum perferendis aspernatur voluptatum quam animi hic, quisquam iste deleniti accusamus labore et? Quasi, explicabo architecto.</p>
        <img src="./images/file_369752.png" alt="">
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto dicta, sequi quaerat tempore beatae illo. Dolorum odio, mollitia excepturi possimus consectetur suscipit doloremque reprehenderit impedit non iusto blanditiis enim. Reiciendis repudiandae architecto placeat rerum molestiae illum odio qui voluptas nobis, blanditiis tempore, nostrum, fugiat tenetur provident dicta facere minima? Laudantium ullam officia, quibusdam soluta dolore perferendis labore atque itaque hic, incidunt tempora ipsa vitae, ab fuga placeat laborum excepturi unde quam ipsam iure. Voluptas accusamus non minus rem consequatur placeat similique sunt excepturi nulla quaerat sapiente commodi molestias asperiores modi voluptate nesciunt, sint repellat alias quibusdam consequuntur reiciendis? Quia, voluptatem voluptate, temporibus voluptatibus eligendi pariatur a atque eius saepe sint debitis. Ullam dolor tempore obcaecati similique voluptas soluta? Dolore quaerat natus rerum blanditiis odio nam laborum. Praesentium iusto aperiam maiores repellendus velit accusamus eum quisquam officia doloremque vitae culpa deleniti beatae porro, molestias eaque qui vero iure, sequi, doloribus architecto eos ipsum cupiditate. Temporibus deserunt quisquam dignissimos. Quod fugiat velit totam sint id deleniti nemo, inventore in hic debitis officia tenetur? Asperiores incidunt error sequi laborum a vitae numquam cumque at consectetur alias dolores earum perferendis aspernatur voluptatum quam animi hic, quisquam iste deleniti accusamus labore et? Quasi, explicabo architecto.</p>
        <img src="./images/file_369780.png" alt="">
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto dicta, sequi quaerat tempore beatae illo. Dolorum odio, mollitia excepturi possimus consectetur suscipit doloremque reprehenderit impedit non iusto blanditiis enim. Reiciendis repudiandae architecto placeat rerum molestiae illum odio qui voluptas nobis, blanditiis tempore, nostrum, fugiat tenetur provident dicta facere minima? Laudantium ullam officia, quibusdam soluta dolore perferendis labore atque itaque hic, incidunt tempora ipsa vitae, ab fuga placeat laborum excepturi unde quam ipsam iure. Voluptas accusamus non minus rem consequatur placeat similique sunt excepturi nulla quaerat sapiente commodi molestias asperiores modi voluptate nesciunt, sint repellat alias quibusdam consequuntur reiciendis? Quia, voluptatem voluptate, temporibus voluptatibus eligendi pariatur a atque eius saepe sint debitis. Ullam dolor tempore obcaecati similique voluptas soluta? Dolore quaerat natus rerum blanditiis odio nam laborum. Praesentium iusto aperiam maiores repellendus velit accusamus eum quisquam officia doloremque vitae culpa deleniti beatae porro, molestias eaque qui vero iure, sequi, doloribus architecto eos ipsum cupiditate. Temporibus deserunt quisquam dignissimos. Quod fugiat velit totam sint id deleniti nemo, inventore in hic debitis officia tenetur? Asperiores incidunt error sequi laborum a vitae numquam cumque at consectetur alias dolores earum perferendis aspernatur voluptatum quam animi hic, quisquam iste deleniti accusamus labore et? Quasi, explicabo architecto.</p>
        <img src="./images/file_369781.png" alt="">
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto dicta, sequi quaerat tempore beatae illo. Dolorum odio, mollitia excepturi possimus consectetur suscipit doloremque reprehenderit impedit non iusto blanditiis enim. Reiciendis repudiandae architecto placeat rerum molestiae illum odio qui voluptas nobis, blanditiis tempore, nostrum, fugiat tenetur provident dicta facere minima? Laudantium ullam officia, quibusdam soluta dolore perferendis labore atque itaque hic, incidunt tempora ipsa vitae, ab fuga placeat laborum excepturi unde quam ipsam iure. Voluptas accusamus non minus rem consequatur placeat similique sunt excepturi nulla quaerat sapiente commodi molestias asperiores modi voluptate nesciunt, sint repellat alias quibusdam consequuntur reiciendis? Quia, voluptatem voluptate, temporibus voluptatibus eligendi pariatur a atque eius saepe sint debitis. Ullam dolor tempore obcaecati similique voluptas soluta? Dolore quaerat natus rerum blanditiis odio nam laborum. Praesentium iusto aperiam maiores repellendus velit accusamus eum quisquam officia doloremque vitae culpa deleniti beatae porro, molestias eaque qui vero iure, sequi, doloribus architecto eos ipsum cupiditate. Temporibus deserunt quisquam dignissimos. Quod fugiat velit totam sint id deleniti nemo, inventore in hic debitis officia tenetur? Asperiores incidunt error sequi laborum a vitae numquam cumque at consectetur alias dolores earum perferendis aspernatur voluptatum quam animi hic, quisquam iste deleniti accusamus labore et? Quasi, explicabo architecto.</p>
        <h3>嘗試往上移動觸發動畫吧?</h3>
        <div class="clear"></div>
    </div>


    <script>
        ;(function(){
            const imgs = document.querySelectorAll('.content>img')

            // 原作者閉包
            // https://github.com/wesbos/JavaScript30/blob/master/13%20-%20Slide%20in%20on%20Scroll/index-FINISHED.html
            function debounce(func, wait = 20, immediate = true) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                var later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
            };



            window.addEventListener('scroll',animationHandler)

                function animationHandler(){
                let n = 0
                // 降低觸發頻率次數 更精確的降低必須使用debounce閉包 func
                // 這邊將每次滾動觸發次數降低至30~31次
                setTimeout(()=>{
                    // 取當前卷軸位置
                    const nowHeight = document.documentElement.scrollTop
                    n++
                    console.log(`+上setTimeout做的次數`)
                    // 取當前網頁可見的高度
                    const height = document.documentElement.clientHeight;
                    imgs.forEach(item=>{
                        // 取每個元素的離頂點高度
                        const top = item.offsetTop;
                        // 取每個照片高度
                        // const imgHeight = parseInt(window.getComputedStyle(item,null).height,10)
                        // 決定是否觸發動畫 - item.height/2意思是 現在可見的高度減掉圖片的一半高度 讓動畫更難觸發(到圖片的一半位置)
                        const control = top - nowHeight <= height - item.height/2
                        control ? item.classList.add('scroll_animation') : item.classList.remove('scroll_animation')
                        // 決定離開可見高度後(網頁繼續往下捲動)是否移除動畫
                        // const leave = nowHeight >= top+imgHeight
                        const leave = nowHeight >= top+item.height
                        leave ? item.classList.remove('scroll_animation') : ''
                    })
                },100)
            }

        })()

    </script>

</body>
</html>